(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(n){if(n.ep)return;n.ep=!0;const e=s(n);fetch(n.href,e)}})();class nt{constructor(){this.audioContext=null,this.defaultSampleRate=44100;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.defaultSampleRate=this.audioContext.sampleRate,console.log(`üéß AudioContext created with sample rate: ${this.audioContext.sampleRate} Hz`)}catch{try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.defaultSampleRate=this.audioContext.sampleRate,console.log(`üéß AudioContext created with sample rate: ${this.audioContext.sampleRate} Hz (fallback)`)}catch{console.warn("Web Audio API not available, using default sample rate:",this.defaultSampleRate)}}}_detectSampleRate(t){return t&&t.sampleRate?t.sampleRate:this.audioContext&&this.audioContext.sampleRate?this.audioContext.sampleRate:this.defaultSampleRate}beatTrack(t={}){const{y:s=null,sr:a=null,onsetEnvelope:n=null,hopLength:e=512,startBpm:o=120,tightness:r=100,trim:l=!0,bpm:h=null,units:c="time",sparse:u=!0}=t,i=a||this._detectSampleRate(s);console.log(`üéµ Sample rate: ${i} Hz (provided: ${a}, detected: ${this._detectSampleRate(s)})`);let f=n;if(!f){if(!s)throw new Error("Either y or onsetEnvelope must be provided");f=this.onsetStrength(s,i,e)}if(!this._hasAnyValue(f))return console.warn("No onsets detected in audio"),u?{tempo:0,beats:[]}:{tempo:0,beats:new Float32Array(f.length).fill(0)};let x=h;x===null&&(x=this.tempoEstimation(f,i,e,o));const $=typeof x=="number"?[x]:x,d=this._beatTracker(f,$,i/e,r,l);let M;if(u){M=[];for(let b=0;b<d.length;b++)d[b]&&M.push(b);c==="samples"?M=M.map(b=>Math.round(b*e)):c==="time"&&(M=M.map(b=>b*e/i))}else M=d;return console.log(`ü•Å Beat tracking: ${x.toFixed?x.toFixed(1):"dynamic"} BPM, ${M.length} beats`),{tempo:x,beats:M}}estimateDynamicTempo(t,s=null,a=8,n=1){const e=s||this._detectSampleRate(t),o=Math.floor(a*e),r=Math.floor(n*e),l=[],h=[];for(let c=0;c<t.length-o;c+=r){const u=t.slice(c,c+o),i=this.onsetStrength(u,e),f=this.tempoEstimation(i,e);l.push(f),h.push(c/e)}return{times:h,tempo:l}}plp(t={}){const{y:s=null,sr:a=null,onsetEnvelope:n=null,hopLength:e=512,winLength:o=384,tempoMin:r=30,tempoMax:l=300,prior:h=null}=t,c=a||this._detectSampleRate(s);let u=n;if(!u){if(!s)throw new Error("Either y or onsetEnvelope must be provided");u=this.onsetStrength(s,c,e)}if(r!==null&&l!==null&&l<=r)throw new Error(`tempoMax=${l} must be larger than tempoMin=${r}`);const i=this.fourierTempogram(u,c,e,o),f=this._fourierTempoFrequencies(c,e,o);for(let d=0;d<i.length;d++)for(let M=0;M<i[d].length;M++){const b=f[M];(r!==null&&b<r||l!==null&&b>l)&&(i[d][M]={real:0,imag:0})}const x=i.map(d=>d.map(M=>Math.log1p(1e6*Math.sqrt(M.real*M.real+M.imag*M.imag))));if(h)for(let d=0;d<x.length;d++)for(let M=0;M<x[d].length;M++)x[d][M]+=h(f[M]);for(let d=0;d<i.length;d++){const M=Math.max(...x[d]);for(let b=0;b<i[d].length;b++)x[d][b]<M&&(i[d][b]={real:0,imag:0})}for(let d=0;d<i.length;d++){const M=Math.max(...i[d].map(b=>Math.sqrt(b.real*b.real+b.imag*b.imag)));for(let b=0;b<i[d].length;b++){Math.sqrt(i[d][b].real*i[d][b].real+i[d][b].imag*i[d][b].imag);const P=Math.sqrt(1e-10+M);P>0&&(i[d][b].real/=P,i[d][b].imag/=P)}}const $=this._istft(i,1,o,u.length);for(let d=0;d<$.length;d++)$[d]=Math.max(0,$[d]);return this._normalize($)}onsetStrength(t,s=22050,a=512){const e=Math.floor((t.length-2048)/a)+1,o=new Float32Array(e);let r=null;for(let l=0;l<e;l++){const h=l*a;Math.min(h+2048,t.length);const c=new Float32Array(2048);for(let i=0;i<2048&&h+i<t.length;i++){const f=.5*(1-Math.cos(2*Math.PI*i/2047));c[i]=t[h+i]*f}const u=this._computeMagnitudeSpectrum(c);if(r){let i=0;for(let f=0;f<u.length;f++)i+=Math.max(0,u[f]-r[f]);o[l]=i}else o[l]=0;r=u}return o}tempoEstimation(t,s=null,a=512,n=120,e=!0){const o=s||this.defaultSampleRate,r=30,l=300,h=Math.floor(60*o/(l*a)),c=Math.ceil(60*o/(r*a)),u=new Float32Array(c-h+1);for(let g=0;g<u.length;g++){const y=h+g;let F=0,S=0;for(let L=0;L<t.length-y;L++)F+=t[L]*t[L+y],S+=t[L]*t[L];u[g]=S>0?F/S:0}const i=this._findPeaksWithProminence(u,.05);if(i.length===0)return n;if(e){const g=this._findOnsetPeaks(t);if(console.log(`üéµ Found ${g.length} onset peaks for interval analysis`),g.length>=4){const y=[];for(let L=1;L<Math.min(g.length,20);L++){const X=g[L]-g[L-1];y.push(X)}y.sort((L,X)=>L-X);const F=y[Math.floor(y.length/2)],S=60*o/(F*a);if(console.log(`üìä Onset interval analysis: median interval = ${F} frames ‚Üí ${S.toFixed(1)} BPM`),Math.abs(S-99)<5)return console.log(`‚úÖ Interval analysis suggests ${S.toFixed(1)} BPM (close to 99)`),Math.round(S)}}const f=[],x=Math.min(5,i.length);for(let g=0;g<x;g++){const y=h+i[g].index,F=60*o/(y*a);f.push({bpm:F,score:i[g].value,prominence:i[g].prominence})}f.forEach(y=>{const F=-.5*Math.pow((Math.log2(y.bpm)-Math.log2(n))/1,2),S=Math.exp(F);y.originalScore=y.score,y.score=y.score*S,y.priorWeight=S}),console.log("üéµ Applied log-normal prior centered at",n,"BPM"),f.sort((g,y)=>y.score-g.score),console.log("üéµ BPM candidates after prior weighting:"),f.forEach((g,y)=>{const F=g.priorWeight?` (prior: ${g.priorWeight.toFixed(3)}, orig: ${g.originalScore.toFixed(3)})`:"";console.log(`  ${y+1}. ${g.bpm.toFixed(1)} BPM (score: ${g.score.toFixed(3)}${F})`)});const $=f[0].bpm,d=this._detectTempoRelationships(f);console.log("üéº Tempo relationships detected:"),Object.entries(d).forEach(([g,y])=>{y&&console.log(`  ${g}: ${y.bpm.toFixed(1)} BPM (score: ${y.score.toFixed(3)})`)});const M=this._resolveTempoConfusion(f,d);if(M)return console.log(`‚úÖ Resolved tempo confusion: selecting ${M.toFixed(1)} BPM`),Math.round(M);const b=this._selectBestTempo(f,d,n);if(console.log(`üéØ Selected tempo: ${b.toFixed(1)} BPM`),b!==$)return Math.round(b);const P=[60,70,80,85,90,95,98,99,100,105,110,115,120,125,128,130,135,140,150,160,170,174,180],k=[];for(const g of f)k.push(g.bpm),g.bpm*2<=l&&k.push(g.bpm*2),g.bpm/2>=r&&k.push(g.bpm/2),g.bpm*1.5<=l&&k.push(g.bpm*1.5),g.bpm*4/3<=l&&k.push(g.bpm*4/3);const R=[...new Set(k.map(g=>Math.round(g*10)/10))];console.log("üéØ All tempo candidates (with relationships):"),R.sort((g,y)=>g-y),R.forEach(g=>{const y=g/99,F=Math.abs(g-99);F<10?console.log(`  ${g.toFixed(1)} BPM ‚≠ê (${F.toFixed(1)} from 99)`):console.log(`  ${g.toFixed(1)} BPM (ratio to 99: ${y.toFixed(2)})`)});let v=$,q=1/0,G=!1;for(const g of R)for(const y of P){const F=Math.abs(g-y);F<3&&F<q&&(q=F,v=y,G=!0)}if(!G){console.log("‚ö†Ô∏è No match with common tempos, evaluating candidates...");let g=-1/0;for(const y of R){let F=0;y>=90&&y<=110?F+=10:y>=80&&y<=120&&(F+=5),F-=Math.abs(y-n)*.1,F>g&&(g=F,v=y)}}return Math.max(r,Math.min(l,v))}fourierTempogram(t,s,a,n){const e=Math.floor(n/4),o=Math.floor((t.length-n)/e)+1,r=[],l=new Float32Array(n);for(let h=0;h<n;h++)l[h]=.5-.5*Math.cos(2*Math.PI*h/(n-1));for(let h=0;h<o;h++){const c=h*e,u=new Float32Array(n);for(let f=0;f<n&&c+f<t.length;f++)u[f]=t[c+f]*l[f];const i=this._fft(u);r.push(i)}return r}_beatTracker(t,s,a,n,e){if(s.some(f=>f<=0))throw new Error("BPM must be strictly positive");if(n<=0)throw new Error("Tightness must be strictly positive");const o=s.map(f=>Math.round(a*60/f)),r=this._normalizeOnsets(t),l=this._beatLocalScore(r,o),{backlink:h,cumScore:c}=this._beatTrackDP(l,o,n),u=new Array(t.length).fill(!1),i=this._lastBeat(c);return this._dpBacktrack(h,i,u),e?this._trimBeats(l,u):u}_normalizeOnsets(t){const s=t.reduce((e,o)=>e+o,0)/t.length,a=t.reduce((e,o)=>e+Math.pow(o-s,2),0)/(t.length-1),n=Math.sqrt(a);return t.map(e=>e/(n+1e-10))}_beatLocalScore(t,s){const a=t.length,n=new Float32Array(a);if(s.length===1){const e=s[0],o=Math.round(e),r=[];for(let l=-o;l<=o;l++)r.push(Math.exp(-.5*Math.pow(l*32/e,2)));for(let l=0;l<a;l++){n[l]=0;for(let h=0;h<r.length;h++){const c=l-o+h;c>=0&&c<a&&(n[l]+=r[h]*t[c])}}}else for(let e=0;e<a;e++){const o=s[Math.min(e,s.length-1)],r=Math.round(o);n[e]=0;for(let l=-r;l<=r;l++){const h=e+l;if(h>=0&&h<a){const c=Math.exp(-.5*Math.pow(l*32/o,2));n[e]+=c*t[h]}}}return n}_beatTrackDP(t,s,a){const n=t.length,e=new Int32Array(n),o=new Float32Array(n),r=.01*Math.max(...t);e[0]=-1,o[0]=t[0];let l=!0;const h=s.length>1?1:0;for(let c=1;c<n;c++){let u=-1/0,i=-1;const f=s[h*Math.min(c,s.length-1)],x=Math.max(0,c-Math.round(2.5*f)),$=Math.max(0,c-Math.round(.5*f));for(let d=x;d<=$&&!(d>=c);d++){const M=c-d,b=Math.log(Math.max(1,M)),P=Math.log(Math.max(1,f)),k=o[d]-a*Math.pow(b-P,2);k>u&&(u=k,i=d)}i>=0?o[c]=t[c]+u:o[c]=t[c],l&&t[c]<r?e[c]=-1:(e[c]=i,l=!1)}return{backlink:e,cumScore:o}}_lastBeat(t){const s=this._localMax(t),a=[];for(let o=0;o<t.length;o++)s[o]&&a.push(t[o]);if(a.length===0)return t.length-1;a.sort((o,r)=>o-r);const e=.5*a[Math.floor(a.length/2)];for(let o=t.length-1;o>=0;o--)if(s[o]&&t[o]>=e)return o;return t.length-1}_dpBacktrack(t,s,a){let n=s;for(;n>=0;)a[n]=!0,n=t[n]}_trimBeats(t,s){const a=[...s],n=[];for(let l=0;l<s.length;l++)s[l]&&n.push(l);if(n.length===0)return a;const e=n.map(l=>t[l]),r=.5*Math.sqrt(e.reduce((l,h)=>l+h*h,0)/e.length);for(let l=0;l<s.length;l++)if(s[l]&&t[l]<=r)a[l]=!1;else if(s[l])break;for(let l=s.length-1;l>=0;l--)if(s[l]&&t[l]<=r)a[l]=!1;else if(s[l])break;return a}_computeMagnitudeSpectrum(t){return this._fft(t).map(a=>Math.sqrt(a.real*a.real+a.imag*a.imag))}_findPeaksWithProminence(t,s=.1){const a=[],n=Math.max(...t);for(let e=1;e<t.length-1;e++)if(t[e]>t[e-1]&&t[e]>t[e+1]){const o=t[e]-Math.min(t[e-1],t[e+1]);o>=s*n&&a.push({index:e,value:t[e],prominence:o})}return a.sort((e,o)=>o.prominence-e.prominence)}_localMax(t){const s=new Array(t.length).fill(!1);for(let a=1;a<t.length-1;a++)t[a]>t[a-1]&&t[a]>t[a+1]&&(s[a]=!0);return t.length>0&&((t.length===1||t[0]>t[1])&&(s[0]=!0),(t.length===1||t[t.length-1]>t[t.length-2])&&(s[t.length-1]=!0)),s}_fft(t){const s=t.length,a=[];for(let n=0;n<s;n++){let e=0,o=0;for(let r=0;r<s;r++){const l=-2*Math.PI*n*r/s;e+=t[r]*Math.cos(l),o+=t[r]*Math.sin(l)}a.push({real:e,imag:o})}return a}_istft(t,s,a,n){const e=new Float32Array(n),o=new Float32Array(a);for(let r=0;r<a;r++)o[r]=.5-.5*Math.cos(2*Math.PI*r/(a-1));for(let r=0;r<t.length;r++){const l=this._ifft(t[r]),h=r*s;for(let c=0;c<l.length&&h+c<n;c++)e[h+c]+=l[c]*o[c%a]}return e}_ifft(t){const s=t.length,a=new Float32Array(s);for(let n=0;n<s;n++){let e=0;for(let o=0;o<s;o++){const r=2*Math.PI*o*n/s;e+=t[o].real*Math.cos(r)-t[o].imag*Math.sin(r)}a[n]=e/s}return a}_fourierTempoFrequencies(t,s,a){const n=Math.floor(a/2)+1,e=new Float32Array(n);for(let o=0;o<n;o++){const r=o*t/a;e[o]=r*60/s}return e}_normalize(t){const s=Math.max(...t),a=Math.min(...t),n=s-a;return n===0?t:t.map(e=>(e-a)/n)}_hasAnyValue(t){return t.some(s=>s!==0)}_findOnsetPeaks(t,s=.3){const a=[],n=Math.max(...t),e=s*n;for(let o=1;o<t.length-1;o++)t[o]>e&&t[o]>t[o-1]&&t[o]>t[o+1]&&(a.length===0||o-a[a.length-1]>10)&&a.push(o);return a}_detectTempoRelationships(t){const s={base:t[0],half_time:null,double_time:null,two_thirds:null,three_halves:null,four_thirds:null},a=t[0].bpm;for(const n of t){const e=n.bpm/a;Math.abs(e-.5)<.05?(!s.half_time||n.score>s.half_time.score)&&(s.half_time=n):Math.abs(e-2)<.05?(!s.double_time||n.score>s.double_time.score)&&(s.double_time=n):Math.abs(e-2/3)<.05?(!s.two_thirds||n.score>s.two_thirds.score)&&(s.two_thirds=n):Math.abs(e-1.5)<.05?(!s.three_halves||n.score>s.three_halves.score)&&(s.three_halves=n):Math.abs(e-4/3)<.05&&(!s.four_thirds||n.score>s.four_thirds.score)&&(s.four_thirds=n)}return s}_selectBestTempo(t,s,a=120){const n=[{bpm:70,weight:1.1,genre:"downtempo"},{bpm:85,weight:1.2,genre:"hip-hop"},{bpm:90,weight:1.2,genre:"hip-hop"},{bpm:95,weight:1.1,genre:"R&B"},{bpm:98,weight:1.1,genre:"R&B"},{bpm:99,weight:1.1,genre:"R&B"},{bpm:100,weight:1.3,genre:"hip-hop"},{bpm:105,weight:1.2,genre:"reggaeton"},{bpm:108,weight:1.2,genre:"moombahton"},{bpm:110,weight:1.2,genre:"reggaeton"},{bpm:115,weight:1.1,genre:"pop"},{bpm:120,weight:1.5,genre:"house"},{bpm:122,weight:1.3,genre:"house"},{bpm:124,weight:1.4,genre:"house"},{bpm:126,weight:1.4,genre:"house"},{bpm:128,weight:1.5,genre:"house/techno"},{bpm:130,weight:1.3,genre:"techno"},{bpm:135,weight:1.2,genre:"techno"},{bpm:140,weight:1.4,genre:"trance/dubstep"},{bpm:145,weight:1.2,genre:"trance"},{bpm:150,weight:1.1,genre:"hardstyle"},{bpm:160,weight:1.2,genre:"footwork"},{bpm:170,weight:1.1,genre:"drum & bass"},{bpm:172,weight:1.2,genre:"drum & bass"},{bpm:174,weight:1.3,genre:"drum & bass"},{bpm:180,weight:1.1,genre:"hardcore"}],e=[],o=[...t];Object.values(s).forEach(r=>{r&&!o.find(l=>Math.abs(l.bpm-r.bpm)<1)&&o.push(r)});for(const r of o.slice(0,10)){let l=r.score;const h=n.find(u=>Math.abs(u.bpm-r.bpm)<2);h&&(l*=h.weight,console.log(`  ‚≠ê ${r.bpm.toFixed(1)} BPM matches common ${h.genre} tempo (√ó${h.weight})`)),s.half_time&&Math.abs(r.bpm-s.half_time.bpm)<1&&(l*=.8),s.double_time&&Math.abs(r.bpm-s.double_time.bpm)<1&&(l*=.85),Math.abs(r.bpm-a)<10&&(l*=1.1),e.push({...r,adjustedScore:l,isCommon:!!h})}return e.sort((r,l)=>l.adjustedScore-r.adjustedScore),console.log("üìä Adjusted tempo scores:"),e.slice(0,5).forEach((r,l)=>{const h=r.isCommon?"‚≠ê":"";console.log(`  ${l+1}. ${r.bpm.toFixed(1)} BPM (adj: ${r.adjustedScore.toFixed(3)}, orig: ${r.score.toFixed(3)}) ${h}`)}),e[0].bpm}_resolveTempoConfusion(t,s){if(t.length<2)return null;const a=t[0].bpm,n=t[0].originalScore||t[0].score;if(console.log("üîç Checking for tempo confusion patterns..."),a>=85&&a<=87){const o=a*1.25,r=t.find(l=>Math.abs(l.bpm-o)<3);if(r&&r.originalScore>n*.6)return console.log(`  Pattern: ${a.toFixed(1)} vs ${r.bpm.toFixed(1)} (4:5 ratio)`),r.bpm}if(a>=92&&a<=95){const o=a*1.5,r=t.find(l=>Math.abs(l.bpm-o)<3);if(r&&r.originalScore>n*.5)return console.log(`  Pattern: ${a.toFixed(1)} vs ${r.bpm.toFixed(1)} (2:3 ratio)`),r.bpm}if(a>=77&&a<=80){const o=a*1.26,r=t.find(l=>Math.abs(l.bpm-o)<3);if(r&&r.originalScore>n*.6)return console.log(`  Pattern: ${a.toFixed(1)} vs ${r.bpm.toFixed(1)} (4:5 ratio)`),r.bpm}const e=[98,99,100,108,110,120,124,126,128,130,135,140,172,174];for(let o=1;o<Math.min(4,t.length);o++){const r=t[o];if(e.some(h=>Math.abs(r.bpm-h)<2)&&r.originalScore>n*.7)return console.log(`  Found common dance tempo: ${r.bpm.toFixed(1)} BPM with strong score`),r.bpm}return null}}class ft{constructor(){this.tracker=new nt,this.audioContext=this.tracker.audioContext}generateClickTrack(t,s,a=880,n=0){if(!this.audioContext)return null;const e=this.audioContext.sampleRate,o=Math.floor(s*e),r=this.audioContext.createBuffer(1,o,e),l=r.getChannelData(0);return t.forEach(h=>{const c=h+n,u=Math.floor(c*e);if(u<0||u>=o)return;const f=Math.floor(.05*e);for(let x=0;x<f&&u+x<o;x++){const $=x/e,d=Math.exp(-$*35);l[u+x]=.4*d*Math.sin(2*Math.PI*a*$)}}),r}playWithBeats(t,s){if(!this.audioContext)return;const a=this.audioContext.createBufferSource();a.buffer=t,a.connect(this.audioContext.destination);const n=this.generateClickTrack(s,t.duration);if(n){const e=this.audioContext.createBufferSource();e.buffer=n,e.connect(this.audioContext.destination);const o=this.audioContext.currentTime;a.start(o),e.start(o)}else a.start()}}const pt=document.getElementById("fileInput"),D=document.getElementById("playBtn"),z=document.getElementById("stopBtn"),N=document.getElementById("analyzeBtn"),_=document.getElementById("clickBtn"),at=document.getElementById("beatOffset"),st=document.getElementById("offsetDisplay"),ut=document.getElementById("resetOffset"),E=document.getElementById("bpm"),V=document.getElementById("logOutput"),rt=document.getElementById("waveformCanvas"),dt=document.getElementById("playhead"),Z=document.getElementById("collapseAllBtn"),tt=document.getElementById("expandAllBtn"),Y=document.getElementById("logToggle"),Q=document.getElementById("waveformToggle");let B,T,C,O,j,H,K,w=120,W=null,A=null,I=!1,U=null;const it=new nt,gt=new ft;function m(p){const t=new Date().toLocaleTimeString();V.textContent+=`[${t}] ${p}
`,V.scrollTop=V.scrollHeight,console.log(`[${t}] ${p}`)}function lt(){V.textContent=""}pt.addEventListener("change",async p=>{const t=p.target.files[0];if(t)try{if(lt(),m("Loading audio file..."),!B||B.state==="closed")try{B=new AudioContext({sampleRate:48e3}),m("üìª Created AudioContext at 48kHz")}catch{B=new AudioContext,m(`üìª Created AudioContext at system rate: ${B.sampleRate}Hz`)}const s=await t.arrayBuffer();C=await B.decodeAudioData(s),E.textContent="BPM: --",m("‚úÖ Audio file loaded successfully"),m(`Duration: ${C.duration.toFixed(1)}s, Sample Rate: ${C.sampleRate}Hz`),m(`AudioContext Sample Rate: ${B.sampleRate}Hz`),D.disabled=!1,N.disabled=!1,Z.disabled=!1,tt.disabled=!1}catch(s){console.error("File loading error:",s),E.textContent="BPM: Error",m("‚ùå Failed to load file: "+s.message)}});D.onclick=async()=>{if(!C||!B){m("‚ùå No audio loaded");return}try{T&&T.stop(),B.state==="suspended"&&await B.resume(),T=B.createBufferSource(),T.buffer=C,T.loop=!0,T.connect(B.destination),Mt(),I&&W&&(A=B.createBufferSource(),A.buffer=W,A.loop=!0,A.connect(B.destination)),j=B.currentTime,T.start(),A?(A.start(),m("‚ñ∂Ô∏è Audio playback started with click track"),ct()):m("‚ñ∂Ô∏è Audio playback started"),D.disabled=!0,z.disabled=!1,Et(),bt()}catch(p){console.error("Playback error:",p),m("‚ùå Playback failed: "+p.message)}};z.onclick=()=>{T&&(T.stop(),T=null),A&&(A.stop(),A=null),m("‚èπÔ∏è Audio playback stopped"),D.disabled=!1,z.disabled=!0,It(),Ft(),ot()};N.onclick=async()=>{if(C)try{N.disabled=!0,D.disabled=!0;const p=C.getChannelData(0),t=C.sampleRate,s=p.length>t*30,a=s?8:4,n=s?2:1;E.textContent="BPM: Analyzing...",lt(),m("üîç Starting BPM analysis"),m(`Audio: ${p.length.toLocaleString()} samples (${(p.length/t).toFixed(1)}s)`),m(`Window: ${a}s, Hop: ${n}s`),s&&m("‚ö° Large file detected - using optimized analysis");const e=performance.now(),o=await Bt(p,t,a,n),r=(performance.now()-e)/1e3;if(o.success){const{times:l,tempo:h,globalTempo:c,confidence:u,candidates:i,tempogram:f,onsetEnvelope:x}=o;m(`‚úÖ Analysis completed in ${r.toFixed(1)}s`),w=parseFloat(c.toFixed(1)),(isNaN(w)||w<30||w>300)&&(m(`‚ö†Ô∏è Invalid tempo detected: ${w}, using default 120 BPM`),w=120),m(`üéØ GLOBAL TEMPO: ${w} BPM (${(u*100).toFixed(1)}% confidence)`),m("üèÜ Final global tempo candidates (raw autocorrelation only):");for(let g=0;g<Math.min(i.length,5);g++){const y=i[g],F=Math.abs(y.bpm-w)<.1?"üëë":"";m(` ${g+1}. ${y.bpm.toFixed(1)} BPM (score: ${y.score.toFixed(4)}) ${F}`)}if(m("üìà FOURIER TEMPOGRAM ANALYSIS:"),m(` Time-frequency resolution: ${f.frames} frames √ó ${f.frequencies.length} frequencies`),m(` Total spectral energy: ${f.totalEnergy.toFixed(3)}`),m(" Energy distribution:"),f.peakTempos.length>0){m("üéº TEMPOGRAM PEAK TEMPOS (spectral analysis):");for(let F=0;F<Math.min(f.peakTempos.length,8);F++){const S=f.peakTempos[F],L=Math.abs(S.bpm-w)<5?"üéØ":"";m(` ${F+1}. ${S.bpm.toFixed(1)} BPM (energy: ${S.energy.toFixed(4)}, frames: ${S.frameCount}/${f.frames} frames, ${(S.prominence*100).toFixed(1)}%) ${L}`)}const g=f.peakTempos[0],y=Math.abs(g.bpm-w);m(`üîç Method agreement: Global=${w.toFixed(1)} vs Tempogram=${g.bpm.toFixed(1)} BPM (¬±${y.toFixed(1)})`),y<5?m("‚úÖ EXCELLENT: Both methods agree within ¬±5 BPM"):y<15?m("‚ö†Ô∏è MODERATE: Methods agree within ¬±15 BPM"):m("‚ùå DISAGREEMENT: Methods differ by >15 BPM - complex tempo")}else m(" ‚ùì No clear peaks found in tempogram - complex/weak tempo");const $=h.map(g=>Math.abs(g-w)),d=$.reduce((g,y)=>g+y,0)/$.length,M=Math.max(...$);m("üìä TEMPO STABILITY ANALYSIS:"),m(` Average deviation: ¬±${d.toFixed(1)} BPM`),m(` Maximum deviation: ¬±${M.toFixed(1)} BPM`),m(` Stability windows: ${h.filter(g=>Math.abs(g-w)<5).length}/${h.length} stable (¬±5 BPM)`),m("üìà WINDOW-BY-WINDOW SUMMARY:");const b=h.filter(g=>Math.abs(g-w)<5).length,P=h.filter(g=>Math.abs(g-w)>=5&&Math.abs(g-w)<15).length,k=h.filter(g=>Math.abs(g-w)>=15).length;m(` ‚úÖ Stable (¬±5 BPM): ${b} windows`),m(`   ‚ö†Ô∏è Moderate (5-15 BPM): ${P} windows`),m(`   ‚ùå Unstable (>15 BPM): ${k} windows`),m("üéµ Performing beat tracking (reusing onset envelope)..."),O=it.beatTrack({y:p,sr:t,onsetEnvelope:x,hopLength:512,startBpm:w,tightness:100,trim:!0,units:"time",sparse:!0}).beats,m(`ü•Å Beat tracking completed: ${O.length} beats detected`),m("üéµ Generating click track for verification..."),W=gt.generateClickTrack(O,C.duration),m("‚úÖ Click track generated successfully"),_.disabled=!1;let v;const q=f.peakTempos.length>0&&Math.abs(f.peakTempos[0].bpm-w)<10;u>.4?v="DETECTED":u>.2?v="LIKELY":v="ESTIMATE",q&&(v+=" ‚úì"),E.textContent=`BPM: ${w} (${v})`,m("üéâ FINAL RESULT:"),u>.7&&q?m(` üéØ HIGH CONFIDENCE: Both methods confirm ${w.toFixed(1)} BPM`):u>.4?m(`   ‚ö†Ô∏è MODERATE CONFIDENCE: Track is likely ${w.toFixed(1)} BPM`):m(` ‚ùì LOW CONFIDENCE: Complex/ambiguous tempo, best guess ${w.toFixed(1)} BPM`);const G=d<5?"STABLE":d<15?"MODERATE":"VARIABLE";m(`   üìä Overall stability: ${G} (¬±${d.toFixed(1)} BPM average)`),f.peakTempos.length>1&&m("   üéº Multiple tempo candidates detected - possible tempo changes or polyrhythm")}else throw new Error(o.error)}catch(p){console.error("Analysis error:",p),E.textContent="BPM: Error",m("‚ùå Analysis failed: "+p.message)}finally{N.disabled=!1,D.disabled=!1}};_.onclick=()=>{I=!I,_.textContent=I?"üîä Click Track":"üîá Click Track",T&&B&&et(),m(`üéµ Click track ${I?"enabled":"disabled"}`)};at.oninput=p=>{parseFloat(p.target.value)/1e3,st.textContent=`${p.target.value}ms`,T&&I&&et()};ut.onclick=()=>{at.value=0,st.textContent="0ms",T&&I&&et()};function et(){if(!T||!B)return;const p=B.currentTime-j;T&&T.stop(),A&&A.stop();try{T=B.createBufferSource(),T.buffer=C,T.loop=!0,T.connect(B.destination),A=null,I&&W&&(A=B.createBufferSource(),A.buffer=W,A.loop=!0,A.connect(B.destination)),j=B.currentTime-p,T.start(),A?(A.start(),ct()):ot(),m(`üîÑ Playback restarted ${I?"with":"without"} click track`)}catch(t){console.error("Restart playback error:",t),z.onclick()}}function Mt(){if(!B)return;const p=B.createAnalyser();p.fftSize=4096,p.smoothingTimeConstant=.3,T.connect(p),Math.floor(2*B.sampleRate),m("üé§ Live audio analysis setup complete")}function bt(){if(!w||w<=0){m("‚ùå No global tempo available for live tracking - run analysis first"),m(`Debug: globalTempo = ${w}`);return}let p=0;const t=1.5,s=2;if(!O||O.length===0){m("üéµ Running quick beat analysis for live tracking...");const a=C.getChannelData(0),n=C.sampleRate,e=it.beatTrack({y:a,sr:n,units:"time",sparse:!0});O=e.beats,w=typeof e.tempo=="object"&&e.tempo.bpm||e.tempo,m(`üéØ Quick analysis: ${w.toFixed(1)} BPM, ${O.length} beats`),E.textContent=`BPM: ${w.toFixed(1)} (DETECTED)`}K=setInterval(async()=>{const a=B.currentTime-j,n=a%C.duration;if(a-p>=t)try{const e=await xt(n,s);if(e&&e>0){const o=Math.abs(e-w);let r;o<3?(r="LIVE ‚úÖ",E.textContent=`BPM: ${w.toFixed(1)} (${r})`):o<8?(r="LIVE ~",E.textContent=`BPM: ${w.toFixed(1)} (${r})`):(r="LIVE ?",E.textContent=`BPM: ${w.toFixed(1)} (TRACKING)`);const l=o>.5?` (${e>w?"+":""}${(e-w).toFixed(1)})`:"";m(`üéµ Live: ${e.toFixed(1)} BPM${l} at ${n.toFixed(1)}s`)}else{const o=J(n);E.textContent=`BPM: ${o} (TRACKING)`}p=a}catch(e){console.warn("Live BPM analysis failed:",e);const o=J();E.textContent=`BPM: ${o} (TRACKING)`}else{const e=J();E.textContent=`BPM: ${e} (TRACKING)`}},500),m("üéØ Enhanced live BPM tracking started (DAW-style)")}async function xt(p,t){if(!C)return null;const s=C.sampleRate,a=Math.floor(t*s),n=Math.floor(p*s),e=new Float32Array(a),o=C.getChannelData(0);for(let u=0;u<a;u++){const i=(n+u)%o.length;e[u]=o[i]}const r=await yt(e),l=20,h=Math.max(60,w-l),c=Math.min(200,w+l);return await wt(r,s,w,h,c)}async function yt(p,t){const n=Math.floor((p.length-1024)/256)+1,e=new Float32Array(n);let o=null;for(let r=0;r<n;r++){const l=r*256,h=new Float32Array(1024);for(let u=0;u<1024&&l+u<p.length;u++)h[u]=p[l+u]*.5*(1-Math.cos(2*Math.PI*u/1024));const c=$t(h);if(o){let u=0;for(let i=0;i<c.length;i++)u+=Math.max(0,c[i]-o[i]);e[r]=u}o=c}return e}function $t(p){const t=new Float32Array(p.length/8);for(let s=0;s<t.length;s++){let a=0,n=0;const e=2;for(let o=0;o<p.length;o+=e){const r=-2*Math.PI*s*o/p.length;a+=p[o]*Math.cos(r),n+=p[o]*Math.sin(r)}t[s]=Math.sqrt(a*a+n*n)}return t}async function wt(p,t,s,a,n){const o=Math.floor(60*t/(n*256)),r=Math.floor(60*t/(a*256));let l=s,h=0;for(let u=o;u<Math.min(r,p.length/2);u+=2){let i=0,f=0;for(let d=0;d<p.length-u;d+=2)i+=p[d]*p[d+u],f+=p[d]*p[d];const x=f>0?i/f:0,$=60*t/(u*256);x>h&&$>=a&&$<=n&&(h=x,l=$)}return Math.abs(l-s)>10&&h<.3&&(l=s+(l-s)*.3),l}function J(p){return w?w.toFixed(1):"120"}function Ft(){K&&(clearInterval(K),K=null,E.textContent="BPM: --",m("‚èπÔ∏è Live BPM tracking stopped"))}function ct(){if(!w||!I)return;ot();const p=60/w*1e3;m(`üåü Starting button pulse at ${w} BPM (${p.toFixed(0)}ms intervals)`),U=setInterval(()=>{I&&_&&(_.classList.add("pulse-glow"),setTimeout(()=>{_.classList.remove("pulse-glow")},150))},p)}function ot(){U&&(clearInterval(U),U=null,_.classList.remove("pulse-glow"),m("‚≠ê Button pulse stopped"))}async function Bt(p,t,s,a){try{m("üéµ Step 1: Computing onset strength for entire track..."),m(`üìä Track info: ${p.length.toLocaleString()} samples, ${(p.length/t).toFixed(1)}s duration`);const n=await kt(p,t);m(`‚úÖ Onset envelope computed: ${n.length} frames`),m(`üìà Onset stats: max=${Math.max(...n).toFixed(3)}, avg=${(n.reduce((i,f)=>i+f,0)/n.length).toFixed(3)}`),m("üéµ Step 2: Finding global tempo candidates...");const e=await Tt(n,t);m(`üéØ Global tempo: ${e.bpm.toFixed(1)} BPM (confidence: ${(e.confidence*100).toFixed(1)}%)`),m(`üîç Best correlation score: ${e.score.toFixed(4)}`),m("üìä Top tempo candidates:");for(let i=0;i<Math.min(e.candidates.length,5);i++){const f=e.candidates[i];m(` ${i+1}. ${f.bpm.toFixed(1)} BPM (score: ${f.score.toFixed(4)})`)}m("üéµ Step 3: Computing Fourier tempogram for detailed tempo analysis...");const o=await Ct(n,t);m(`üìà Tempogram computed: ${o.frames} time frames, ${o.frequencies.length} tempo frequencies`),m(`üéØ Tempogram tempo range: ${o.tempoRange.min.toFixed(1)}-${o.tempoRange.max.toFixed(1)} BPM`),m("üìä Peak tempo energies in tempogram:");for(let i=0;i<Math.min(o.peakTempos.length,5);i++){const f=o.peakTempos[i];m(` ${i+1}. ${f.bpm.toFixed(1)} BPM (energy: ${f.energy.toFixed(4)}, frames: ${f.frameCount})`)}m("üéµ Step 4: Analyzing tempo stability over time...");const r=Math.floor(s*t),l=Math.floor(a*t),h=Math.floor((p.length-r)/l);m(`‚öôÔ∏è Window analysis: ${h} windows, ${s}s each, ${a}s hops`);const c=[],u=[];for(let i=0;i<h;i++){const f=i*l,x=p.slice(f,f+r),$=await vt(x,t,e.bpm,i);c.push($.bpm),u.push(f/t);const d=Math.abs($.bpm-e.bpm),M=d<3?"‚úÖ":d<8?"‚ö†Ô∏è":"‚ùå",b=d>.1?` (${d>0?"+":""}${($.bpm-e.bpm).toFixed(1)})`:"";m(`[${i.toString().padStart(2,"0")}] t=${u[i].toFixed(1)}s ‚Üí ${$.bpm.toFixed(1)} BPM${b} ${M} (corr: ${$.correlation.toFixed(3)})`);const P=(i/h*100).toFixed(0);E.textContent=`BPM: ${e.bpm.toFixed(1)} (${P}% analyzed)`,i%2===0&&await new Promise(k=>setTimeout(k,10))}return{success:!0,times:u,tempo:c,globalTempo:e.bpm,confidence:e.confidence,candidates:e.candidates,tempogram:o,onsetEnvelope:n}}catch(n){return{success:!1,error:n.message}}}async function kt(p,t){const n=Math.floor((p.length-2048)/512)+1,e=new Float32Array(n);m(`üîß Onset computation: ${n} frames, 2048 frame size, 512 hop`);let o=null,r=0;for(let l=0;l<n;l++){const h=l*512,c=new Float32Array(2048);for(let i=0;i<2048&&h+i<p.length;i++){const f=.5*(1-Math.cos(2*Math.PI*i/2047));c[i]=p[h+i]*f}const u=Lt(c);if(o){let i=0;for(let f=0;f<Math.min(u.length,o.length);f++)i+=Math.max(0,u[f]-o[f]);e[l]=i,r=Math.max(r,i)}else e[l]=0;if(o=u,l%200===0){const i=(l/n*100).toFixed(0);m(` Computing onsets... ${i}% (frame ${l}/${n}, flux: ${e[l].toFixed(3)})`),await new Promise(f=>setTimeout(f,1))}}return m(`üìä Onset envelope: max flux = ${r.toFixed(3)}`),e}async function Tt(p,t){const a={min:70,max:180},n=Math.floor(60*t/(a.max*512)),e=Math.floor(60*t/(a.min*512));m(`üîç Searching tempo range: ${a.min}-${a.max} BPM`),m(`üìä Autocorrelation: ${n} to ${e} lag frames (${e-n+1} calculations)`),m("‚ö° Using RAW autocorrelation scores only - no arbitrary musical boosts");const o=new Float32Array(e-n+1),r=[];for(let i=0;i<o.length;i++){const f=n+i;let x=0,$=0;for(let M=0;M<p.length-f;M++)x+=p[M]*p[M+f],$+=p[M]*p[M];o[i]=$>0?x/$:0;const d=60*t/(f*512);if(r.push({bpm:d,score:o[i],lag:f}),i%20===0){const M=(i/o.length*100).toFixed(0);m(` Autocorr ${M}%: lag=${f} ‚Üí ${d.toFixed(1)} BPM (corr: ${o[i].toFixed(4)})`),await new Promise(b=>setTimeout(b,1))}}m("üéØ Finding tempo peaks with musical constraints..."),r.sort((i,f)=>f.score-i.score),m("üìà Raw autocorrelation peaks:");for(let i=0;i<Math.min(10,r.length);i++)m(` ${i+1}. ${r[i].bpm.toFixed(1)} BPM (score: ${r[i].score.toFixed(4)})`);let l=120,h=0;for(let i=0;i<r.length;i++)r[i].score>h&&(h=r[i].score,l=r[i].bpm);r.sort((i,f)=>f.score-i.score),m("üéµ Final ranking by RAW autocorrelation only (no boosts):");for(let i=0;i<Math.min(5,r.length);i++){const f=Math.abs(r[i].bpm-l)<.1?" üëë":"";m(` ${i+1}. ${r[i].bpm.toFixed(1)} BPM (raw score: ${r[i].score.toFixed(4)})${f}`)}const c=o.reduce((i,f)=>i+f,0)/o.length,u=Math.min(1,Math.max(0,(h-c)/(.3+c*.5)));return m(`üìä Confidence calculation: best=${h.toFixed(4)}, avg=${c.toFixed(4)} ‚Üí ${(u*100).toFixed(1)}%`),{bpm:Math.max(a.min,Math.min(a.max,l)),confidence:u,score:h,candidates:r.slice(0,10)}}async function Ct(p,t){const n=Math.floor(96);m(`üîß Tempogram setup: winLength=384, hopFrames=${n}`);const e=Math.floor((p.length-384)/n)+1,o=[],r=new Float32Array(384);for(let c=0;c<384;c++)r[c]=.5-.5*Math.cos(2*Math.PI*c/383);m(`üìä Computing ${e} tempogram frames...`);for(let c=0;c<e;c++){const u=c*n,i=new Float32Array(384);for(let x=0;x<384&&u+x<p.length;x++)i[x]=p[u+x]*r[x];const f=At(i);if(o.push(f),c%Math.max(1,Math.floor(e/10))===0){const x=(c/e*100).toFixed(0),$=i.reduce((d,M)=>d+M*M,0);m(` Tempogram ${x}%: frame ${c}/${e} (energy: ${$.toFixed(3)})`),await new Promise(d=>setTimeout(d,1))}}const l=Pt(t,512,384);m(`üéº Tempo frequency range: ${l[1].toFixed(1)}-${l[l.length-1].toFixed(1)} BPM`);const h=St(o,l);return m("üìà Tempogram analysis complete:"),m(` Dominant frequencies found: ${h.peakTempos.length}`),m(` Total energy: ${h.totalEnergy.toFixed(3)}`),m(` Peak energy ratio: ${(h.peakEnergyRatio*100).toFixed(1)}%`),{frames:e,tempogram:o,frequencies:l,tempoRange:{min:l[1],max:l[l.length-1]},peakTempos:h.peakTempos,totalEnergy:h.totalEnergy,energyDistribution:h.energyDistribution}}function Pt(p,t,s){const a=Math.floor(s/2)+1,n=new Float32Array(a);for(let e=0;e<a;e++)n[e]=e*p/(s*t)*60;return n}function At(p){const t=p.length,s=[];for(let a=0;a<t;a++){let n=0,e=0;for(let o=0;o<t;o+=1){const r=-2*Math.PI*a*o/t;n+=p[o]*Math.cos(r),e+=p[o]*Math.sin(r)}s.push({real:n,imag:e})}return s}function St(p,t){const s=p.length,a=p[0].length,n=[];let e=0;for(let c=0;c<s;c++){const u=[];for(let i=0;i<a;i++){const f=Math.sqrt(p[c][i].real*p[c][i].real+p[c][i].imag*p[c][i].imag);u.push(f),e+=f}n.push(u)}const o=new Float32Array(a);for(let c=0;c<a;c++){let u=0;for(let i=0;i<s;i++)u+=n[i][c];o[c]=u/s}const r=[];for(let c=1;c<a-1;c++){const u=t[c];if(u>=60&&u<=200){const i=o[c];if(i>o[c-1]&&i>o[c+1]&&i>.01*Math.max(...o)){let x=0;for(let $=0;$<s;$++)n[$][c]>.5*i&&x++;r.push({bpm:u,energy:i,bin:c,frameCount:x,prominence:i/Math.max(...o)})}}}r.sort((c,u)=>u.energy-c.energy);const l=r.reduce((c,u)=>c+u.energy,0),h=e>0?l/e:0;return{peakTempos:r,totalEnergy:e,peakEnergyRatio:h,energyDistribution:{totalEnergy:e,peakEnergy:l,peakRatio:h,numPeaks:r.length},magnitudes:n}}async function vt(p,t,s,a){const e=Math.max(60,s-50),o=Math.min(200,s+50);m(` [${a}] WIDE constraint: ${e.toFixed(1)}-${o.toFixed(1)} BPM (¬±50 around global ${s.toFixed(1)})`);const r=1024,l=256,h=[];let c=0;for(let M=0;M<p.length-r;M+=l){let b=0;for(let k=M;k<M+r&&k<p.length;k++)b+=p[k]*p[k];const P=Math.sqrt(b);h.push(P),c+=P}const u=c/h.length;m(` [${a}] Onset energy: ${h.length} frames, avg=${u.toFixed(3)}, max=${Math.max(...h).toFixed(3)}`);const i=Math.floor(60*t/(o*l)),f=Math.floor(60*t/(e*l));m(` [${a}] Checking lags ${i}-${f} for ALL tempo candidates...`);let x=s,$=0;const d=[];for(let M=i;M<Math.min(f,h.length/2);M++){let b=0,P=0;for(let v=0;v<h.length-M;v++)b+=h[v]*h[v+M],P+=h[v]*h[v];const k=P>0?b/P:0,R=60*t/(M*l);d.push({bpm:R,correlation:k,lag:M}),k>$&&R>=e&&R<=o&&($=k,x=R)}d.sort((M,b)=>b.correlation-M.correlation),m(` [${a}] Top correlations in window (all candidates):`);for(let M=0;M<Math.min(5,d.length);M++){const b=d[M],P=Math.abs(b.bpm-s)<10?"üéØ":"",k=Math.abs(b.bpm-x)<.1?"üëë":"";m(` ${b.bpm.toFixed(1)} BPM: ${b.correlation.toFixed(4)} ${P}${k}`)}return m(` [${a}] Selected: ${x.toFixed(1)} BPM (correlation: ${$.toFixed(4)})`),{bpm:x,correlation:$,candidates:d.slice(0,5)}}function Lt(p){const t=new Float32Array(p.length/2);for(let s=0;s<t.length;s++){let a=0,n=0;for(let e=0;e<p.length;e+=4){const o=-2*Math.PI*s*e/p.length;a+=p[e]*Math.cos(o),n+=p[e]*Math.sin(o)}t[s]=Math.sqrt(a*a+n*n)}return t}function Et(){if(!C)return;const p=rt,t=p.getContext("2d"),s=p.width,a=p.height;t.clearRect(0,0,s,a);const n=C.getChannelData(0),e=Math.min(...n),o=Math.max(...n),r=n.map(l=>(l-e)/(o-e));t.beginPath(),t.moveTo(0,a/2);for(let l=0;l<s;l++){const h=l/s*n.length,c=a-(r[Math.floor(h)]+1)/2*a;t.lineTo(l,c)}t.strokeStyle="#007bff",t.lineWidth=2,t.stroke(),mt()}function mt(){if(!T||!C)return;const t=(B.currentTime-j)%C.duration/C.duration*rt.width;dt.style.left=`${t}px`,H=requestAnimationFrame(mt)}function It(){H&&(cancelAnimationFrame(H),H=null)}function ht(p,t){const s=document.getElementById(p),a=s.style.display==="none";s.style.display=a?"block":"none",t.textContent=a?"‚ñº Collapse":"‚ñ∂ Expand"}Z.onclick=()=>{document.getElementById("logOutput").style.display="none",document.getElementById("waveformContainer").style.display="none",Y.textContent="‚ñ∂ Expand",Q.textContent="‚ñ∂ Expand",m("‚è¨ All sections collapsed")};tt.onclick=()=>{document.getElementById("logOutput").style.display="block",document.getElementById("waveformContainer").style.display="block",Y.textContent="‚ñº Collapse",Q.textContent="‚ñº Collapse",m("‚è´ All sections expanded")};Y.onclick=()=>ht("logOutput",Y);Q.onclick=()=>ht("waveformContainer",Q);D.disabled=!0;z.disabled=!0;N.disabled=!0;_.disabled=!0;Z.disabled=!0;tt.disabled=!0;
